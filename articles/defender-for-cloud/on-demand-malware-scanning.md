---
title: On-demand malware scanning in Microsoft Defender for Storage
description: Learn about the benefits and features of on-demand malware scanning in Microsoft Defender for Storage.
ms.date: 10/13/2024
author: dcurwin
ms.author: dacurwin
ms.topic: how-to
---


# On-demand malware scanning

**On-demand malware scanning** in Microsoft Defender for Storage allows you to initiate malware scans on existing blobs within your Azure Storage accounts whenever needed. This feature provides flexibility to scan your data based on specific security needs, compliance requirements, or in response to security incidents. By using Microsoft Defender Antivirus, you can ensure that your stored data remains secure without the need for extra infrastructure or maintenance.

By using on-demand scanning, you can:

- **Respond to security events**: Quickly scan storage accounts in response to security alerts or suspicious activities.

- **Meet compliance requirements**: Perform regular scans to ensure compliance with data protection regulations.

- **Maintain proactive security**: Schedule scans to maintain an ongoing secure environment.

- **Establish a security baseline**: Scan existing data when first enabling Defender for Storage.

Malware can infiltrate cloud storage environments and pose significant risks to organizations. On-demand malware scanning provides a built-in, cloud-native solution to detect and mitigate these threats by scanning your existing data for malicious content.

## Shared aspects with on-upload scanning

The following sections are applicable to both on-demand and on-upload malware scanning. For more information, see the corresponding sections in the **on-upload malware scanning** documentation:

- **Additional costs**

- **Viewing and consuming scan results**

- **Supported content and limitations**

- **Access and data privacy**

- **Handling false positives and false negatives**

## Initiating on-demand scans

### From the Azure portal

1. Sign in to the Azure portal and navigate to your storage account.

1. Access **Defender for Cloud**:

   - Under **Security + networking**, select **Microsoft Defender for Cloud**.

1. **Review cost estimation**:

   - In the **On-demand malware scanning** section, evaluate the estimated cost based on data volume.

1. **Start the scan**:

   - Select **Scan blobs for malware** to initiate the scan.

   - Confirm the action when prompted.

1. **Monitor progress**:

   - Scan status and findings are updated every 20-30 seconds.

   - View details such as scan status, blobs scanned, data scanned, malicious blobs found, and scan duration.

1. **Review findings**:

   - If threats are found, review the details under the **Security incidents and alerts** section.

   - Refresh the page if alerts aren't immediately visible.

> [!NOTE]
> To cancel an ongoing scan, select **Cancel**.

## Using the REST API

### Initiate the scan

- **Request URL**:

    ```bash
    POST https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/{storageAccountName}/providers/Microsoft.Security/defenderForStorageSettings/current/StartMalwareScan?api-version=2022-12-01-preview
    ```

- **Authentication**:
  - Obtain a valid bearer token.

- **Example**:

    ```http
    POST https://management.azure.com/subscriptions/12345678-1234-1234-1234-123456789abc/resourceGroups/myResourceGroup/providers/Microsoft.Storage/storageAccounts/mystorageaccount/providers/Microsoft.Security/defenderForStorageSettings/current/StartMalwareScan?api-version=2022-12-01-preview
    Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOi...
    ```

### Check scan status and results

- **Request URL**:

    ```bash
    GET https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/{storageAccountName}/providers/Microsoft.Security/defenderForStorageSettings/current/MalwareScanStatus?api-version=2022-12-01-preview
    ```

- **Response example**:

    ```json
    {
      "scanId": "abcd1234-5678-90ab-cdef-1234567890ab",
      "scanStatus": "InProgress",
      "scanStartTime": "2024-10-03T12:34:56Z",
      "scanSummary": {
        "blobs": {
          "totalBlobsScanned": 150,
          "maliciousBlobsCount": 2,
          "skippedBlobsCount": 0,
          "scannedBlobsInGB": 10.5
        },
        "estimatedScanCostUSD": 1.575
      }
    }
    ```

### Cancel a scan

- **Request URL**:

    ```bash
    POST https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Storage/storageAccounts/{storageAccountName}/providers/Microsoft.Security/defenderForStorageSettings/current/CancelMalwareScan?api-version=2022-12-01-preview
    ```

## Cost considerations

### Billing

- **Cost estimation**: Provided in the Azure portal before initiating the scan.

   > [!NOTE]
   > The cost estimation is based on the the Blob Capacity metric of the supported blob types for malware scanning, which is updated every few hours. The cost estimation is not localized and is based on the cost in USD per GB scanned.

- **No monthly cap**: The monthly cap of on-upload scanning doesn't apply on the on-demand scanning. Costs are based on actual usage.

### Best practices for cost control

- **Review cost estimates**: Always check the estimated cost before starting a scan.

- **Automate wisely**: Use automation to initiate scans only when necessary.

## How on-demand scanning works

### Initiation

- **Azure portal**: Start a scan directly from the storage account's Defender for Cloud pane.

- **REST API**: Programmatically initiate scans using provided API endpoints.

### Scanning process

1. **Scan start**: User initiates the scan via the Azure portal or API.

2. **Cost estimation**: The Azure portal provides an estimate of scanning costs based on data volume.

3. **Scanning**: All supported blobs in the storage account are scanned using Microsoft Defender Antivirus.

4. **Monitoring and control**:
   - View scan status, progress, and summary in the Azure portal or API.
   - Information includes number of blobs scanned, data volume, malicious files detected, scan status, and duration.

5. **Cancellation**: Ability to cancel the scan at any time through the portal or API.

### Important considerations

- **Scan duration**: May take minutes to hours, depending on data size, type, and number of blobs.

- **Single scan limitation**: Only one on-demand scan can run per storage account at a time.

## Results and notifications

- **Blob index tags**: Each supported blob is updated with scan result tags.

- **Security alerts**: Malicious files detected generate security alerts in Defender for Cloud.

- **Event Grid events**: If configured, scan results are sent as events for automation purposes.

- **Logs**: If configured, detailed scan results are stored in a Log Analytics workspace.

## Best practices

- **Integrate with incident response**: Use on-demand scanning to respond promptly to security incidents.

- **Regular compliance scans**: Schedule periodic scans to meet compliance and auditing requirements.

- **Automation**: Incorporate scans into automation workflows using Logic Apps or runbooks.

- **Cost management**: Review cost estimates before initiating scans to manage expenses.

- **Monitor scan results**: Regularly review scan results and security alerts.

## Related content

- [Introduction to malware scanning](introduction-malware-scanning.md)
- [On-upload malware scanning in Microsoft Defender for Storage](on-upload-malware-scanning.md)
