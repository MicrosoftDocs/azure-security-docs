---
title: Onboard with PowerShell
description: This document walks you through the process of enabling Microsoft Defender for Cloud with PowerShell cmdlets.
ms.topic: quickstart
ms.date: 05/25/2025
ms.custom: mode-api, devx-track-azurepowershell
---

# Automate onboarding of Microsoft Defender for Cloud using PowerShell

You can secure your Azure workloads programmatically, using the Microsoft Defender for Cloud PowerShell module. Using PowerShell enables you to automate tasks and avoid the human error inherent in manual tasks. This is especially useful in large-scale deployments that involve dozens of subscriptions with hundreds and thousands of resources, all of which must be secured from the beginning.

Onboarding Microsoft Defender for Cloud using PowerShell enables you to programmatically automate onboarding and management of your Azure resources and add the necessary security controls.

This article provides a sample PowerShell script that can be modified and used in your environment to roll out Defender for Cloud across your subscriptions.

In this example, we'll enable Defender for Cloud on a subscription with ID: `<Subscription ID>` and apply the recommended settings that provide a high level of protection, by enabling Microsoft Defender for Cloud's enhanced security features, which provides advanced threat protection and detection capabilities:

1. Enable [the enhanced security in Microsoft Defender for Cloud](enable-enhanced-security.md).

1. Set the organization’s [CISO as the security contact for Defender for Cloud alerts and notable events](configure-email-notifications.md).

1. Assign Defender for Cloud’s [default security policies](tutorial-security-policy.md).

## Prerequisites

These steps should be performed before you run the Defender for Cloud cmdlets:

1. Run PowerShell as admin.

1. Run the following commands in PowerShell:

    ```powershell
    Set-ExecutionPolicy -ExecutionPolicy AllSigned
    ```

    ```powershell
    Install-Module -Name Az.Security -Force
    ```

## Onboard Defender for Cloud using PowerShell

1. Register your subscriptions to the Defender for Cloud Resource Provider:

    ```powershell
    Set-AzContext -Subscription "<Subscription ID>"
    ```

    ```powershell
    Register-AzResourceProvider -ProviderNamespace 'Microsoft.Security'
    ```

1. Optional: Set the coverage level (Microsoft Defender for Cloud's enhanced security features on/off) of the subscriptions. If undefined, these features are off:

    ```powershell
    Set-AzContext -Subscription "<Subscription ID>"
    ```

    ```powershell
    Set-AzSecurityPricing -Name "VirtualMachines" -PricingTier "Standard"
    ```

1. Optional: It's highly recommended that you [define the security contact details](configure-email-notifications.md) for the subscriptions you onboard, which will be used as the recipients of alerts and notifications generated by Defender for Cloud:

    ```powershell
    Set-AzSecurityContact -Name "default1" -Email "CISO@my-org.com" -AlertAdmin -NotifyOnAlert
    ```

1. Assign the default Defender for Cloud policy initiative:

    ```powershell
    Register-AzResourceProvider -ProviderNamespace 'Microsoft.PolicyInsights'
    ```

    ```powershell
    $Policy = Get-AzPolicySetDefinition | where {$_.Properties.displayName -EQ 'Microsoft cloud security benchmark'} 

    New-AzPolicyAssignment -Name 'Microsoft cloud security benchmark' -PolicySetDefinition $Policy -Scope '/subscriptions/$($Subscription.Id)'
    ```

You've successfully onboarded Microsoft Defender for Cloud with PowerShell.

You can now use these PowerShell cmdlets with automation scripts to programmatically iterate across subscriptions and resources. This saves time and reduces the likelihood of human error. You can use this [sample script](https://github.com/Microsoft/Azure-Security-Center/blob/master/quickstarts/ASC-Samples.ps1) as reference.

## See also

To learn more about how you can use PowerShell to automate onboarding to Defender for Cloud, see the following article:

* [Az.Security](/powershell/module/az.security)

To learn more about Defender for Cloud, see the following articles:

* [Setting security policies in Microsoft Defender for Cloud](tutorial-security-policy.md). Learn how to configure security policies for your Azure subscriptions and resource groups.
* [Managing and responding to security alerts in Microsoft Defender for Cloud](manage-respond-alerts.md). Learn how to manage and respond to security alerts.
