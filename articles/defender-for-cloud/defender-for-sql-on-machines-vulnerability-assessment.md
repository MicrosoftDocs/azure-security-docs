---
title: Scan for vulnerabilities on SQL servers
description: Learn about Microsoft Defender for SQL servers on machines' integrated vulnerability assessment scanner
ms.topic: how-to
ms.author: dacurwin
author: dcurwin
ms.date: 05/20/2024
#customer intent: As a user, I want to scan for vulnerabilities on SQL servers using Microsoft Defender for SQL servers on machines' integrated vulnerability assessment scanner.
---

# Scan your SQL servers for vulnerabilities

**Microsoft Defender for SQL servers on machines** extends the protections for your Azure-native SQL Servers to fully support hybrid environments and protect SQL servers (all supported version) hosted in Azure, other cloud environments, and even on-premises machines:

- [SQL Server on Virtual Machines](https://azure.microsoft.com/services/virtual-machines/sql-server/)
- On-premises SQL servers:
  - [SQL Server on Azure Arc-enabled servers](/sql/sql-server/azure-arc/overview)
  - [SQL Server running on Windows machines without Azure Arc](/azure/azure-monitor/agents/agent-windows)

The integrated [vulnerability assessment scanner](./sql-azure-vulnerability-assessment-overview.md) discovers, tracks, and helps you remediate potential database vulnerabilities. Assessment scans findings provide an overview of your SQL machines' security state, and details of any security findings.

> [!NOTE]
> The scan is lightweight, safe, only takes a few seconds per database to run and is entirely read-only. It does not make any changes to your database.

## Explore vulnerability assessment reports

The vulnerability assessment service scans your databases every 12 hours.

The vulnerability assessment dashboard provides an overview of your assessment results across all your databases, along with a summary of healthy and unhealthy databases, and an overall summary of failing checks according to risk distribution.

You can view the vulnerability assessment results directly from Defender for Cloud.

1. From Defender for Cloud's sidebar, open the **Recommendations** page.

1. Select the recommendation [SQL servers on machines should have vulnerability findings resolved](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/f97aa83c-9b63-4f9a-99f6-b22c4398f936). For more information, see the [Defender for Cloud recommendations reference page](review-security-recommendations.md).

    :::image type="content" source="./media/security-center-advanced-iaas-data/data-and-storage-sqldb-vulns-on-vm.png" alt-text="SQL servers on machines should have vulnerability findings resolved":::

    The detailed view for this recommendation appears.

    :::image type="content" source="./media/defender-for-sql-on-machines-vulnerability-assessment/sql-vulnerability-findings.png" alt-text="Screenshot of the recommendation details page.":::

1. For more details, drill down:

    - For an overview of scanned resources (databases) and the list of security checks that were tested, open the **Affected resources** and select the server of interest.

    - For an overview of the vulnerabilities grouped by a specific SQL database, select the database of interest.

    In each view, the security checks are sorted by **Severity**. Select a specific security check to see a details pane with a **Description**, how to **Remediate** it, and other related information such as **Impact** or **Benchmark**.

## Set a baseline

As you review your assessment results, you can mark results as being an acceptable baseline in your environment. The baseline is essentially a customization of how the results are reported. Results that match the baseline are considered as passing in subsequent scans. After you've established your baseline security state, the vulnerability assessment scanner only reports on deviations from the baseline. In this way, you can focus your attention on the relevant issues.

:::image type="content" source="media/defender-for-sql-on-machines-vulnerability-assessment/analyze-report-for-details.png" alt-text="As you review your assessment results, you can mark results as being an acceptable baseline in your environment.":::

## Export results

Use the [Continuous export](continuous-export.md) feature of Microsoft Defender for Cloud to export vulnerability assessment findings to Azure Event Hubs or to Log Analytics workspace.

## View vulnerabilities in graphical, interactive reports

Defender for Cloud's integrated Azure Monitor Workbooks gallery includes an interactive report of all findings from the vulnerability scanners for machines, containers in container registries, and SQL servers.

Findings for each of these scanners are reported in separate recommendations:

- [Machines should have vulnerability findings resolved](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/1195afff-c881-495e-9bc5-1486211ae03f)
- [Container registry images should have vulnerability findings resolved (powered by Qualys)](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/dbd0cb49-b563-45e7-9724-889e799fa648)
- [SQL databases should have vulnerability findings resolved](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/82e20e14-edc5-4373-bfc4-f13121257c37)
- [SQL servers on machines should have vulnerability findings resolved](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/f97aa83c-9b63-4f9a-99f6-b22c4398f936)

The 'Vulnerability Assessment Findings' report gathers all of these findings and organizes them by severity, resource type, and category. You can find the report in the workbooks gallery available from Defender for Cloud's sidebar.

:::image type="content" source="media/defender-for-sql-on-machines-vulnerability-assessment/vulnerability-assessment-findings-report-sql.png" alt-text="Defender for Cloud's vulnerability assessment findings report":::

## Disable specific findings

If you have an organizational need to ignore a finding, rather than remediate it, you can optionally disable it. Disabled findings don't impact your secure score or generate unwanted noise.

When a finding matches the criteria you've defined in your disable rules, it won't appear in the list of findings. Typical scenarios include:

- Disable findings with severity below medium
- Disable findings that are non-patchable
- Disable findings from benchmarks that aren't of interest for a defined scope

> [!IMPORTANT]
> To disable specific findings, you need permissions to edit a policy in Azure Policy. Learn more in [Azure RBAC permissions in Azure Policy](/azure/governance/policy/overview#azure-rbac-permissions-in-azure-policy).

To create a rule:

1. From the recommendations detail page for [SQL servers on machines should have vulnerability findings resolved](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/f97aa83c-9b63-4f9a-99f6-b22c4398f936), select **Disable rule**.

1. Select the relevant scope.

1. Define your criteria. You can use any of the following criteria:
    - Finding ID
    - Severity
    - Benchmarks

    :::image type="content" source="./media/defender-for-sql-on-machines-vulnerability-assessment/disable-rule-vulnerability-findings-sql.png" alt-text="Create a disable rule for VA findings on SQL servers on machines.":::

1. Select **Apply rule**. Changes might take up to 24 hours to take effect.

1. To view, override, or delete a rule:

    1. Select **Disable rule**.

    1. From the scope list, subscriptions with active rules show as **Rule applied**.

        :::image type="content" source="./media/remediate-vulnerability-findings-vm/modify-rule.png" alt-text="Screenshot showing how to modify or delete an existing rule in the Defender for Cloud portal.":::

    1. To view or delete the rule, select the ellipsis menu ("...").

## Manage vulnerability assessments programmatically

### Using Azure PowerShell

You can use Azure PowerShell cmdlets to programmatically manage your vulnerability assessments. The supported cmdlets are:

| Cmdlet name as a link | Description |
| :-------------------- | :---------- |
| [Add-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/add-azsecuritysqlvulnerabilityassessmentbaseline) | Add SQL Vulnerability Assessment baseline. |
| [Get-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/get-azsecuritysqlvulnerabilityassessmentbaseline) | Get SQL Vulnerability Assessment baseline. |
| [Get-AzSecuritySqlVulnerabilityAssessmentScanResult](/powershell/module/az.security/get-azsecuritysqlvulnerabilityassessmentscanresult) | Gets SQL Vulnerability Assessment scan results. |
| [Get-AzSecuritySqlVulnerabilityAssessmentScanRecord](/powershell/module/az.security/get-azsecuritysqlvulnerabilityassessmentscanrecord) | Gets SQL Vulnerability Assessment scan records. |
| [Remove-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/remove-azsecuritysqlvulnerabilityassessmentbaseline) | Removes SQL Vulnerability Assessment baseline. |
| [Set-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/set-azsecuritysqlvulnerabilityassessmentbaseline) | Sets new SQL Vulnerability Assessment baseline on a specific database discards old baseline if any exists. |
| &nbsp; | &nbsp; |

## Data residency

SQL Vulnerability Assessment queries the SQL server using publicly available queries under Defender for Cloud recommendations for SQL Vulnerability Assessment, and stores the query results. SQL Vulnerability Assessment data is stored in the location of the Log Analytics workspace that the machine is connected to. For example, if the user connects a SQL Virtual Machine to a Log Analytics workspace in West Europe, the results will be stored in West Europe. This data will be collected only if the SQL Vulnerability Assessment solution is enabled on the Log Analytics workspace.

Metadata information about the connected machine is also collected. Specifically:

- Operating system name, type, and version
- Computer fully qualified domain name (FQDN)
- Connected Machine agent version
- UUID (BIOS ID)
- SQL server name and underlying database names

You can specify the region where your SQL Vulnerability Assessment data will be stored by choosing the Log Analytics workspace location. Microsoft might replicate to other regions for data resiliency, but Microsoft does not replicate data outside the geography.

> [!NOTE]
> Changing the Defender for SQL on Machines plan's Log Analytics workspace will reset the scan results and baseline settings. If you revert to the original Log Analytics workspace within 90 days the the scan results and baseline settings will be made available again.

## Next step

> [!div class="nextstepaction"]
> [Overview of Microsoft Defender for SQL](defender-for-sql-introduction.md).
