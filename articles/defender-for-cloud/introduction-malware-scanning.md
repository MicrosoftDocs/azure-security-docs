---
title: Introduction to Defender for Storage malware scanning
description: Discover how malware scanning in Microsoft Defender for Storage enhances security. It improves compliance and data integrity by detecting and mitigating threats.
ms.date: 09/16/2025
author: dcurwin
ms.author: dacurwin
ms.topic: how-to
#customer intent: As a security administrator, I want to understand malware scanning in Defender for Storage so that I can enhance security and compliance.
---

# Introduction to malware scanning

Malware scanning in Microsoft Defender for Storage improves the security of your Azure Storage accounts by detecting and mitigating malware threats. It uses Microsoft Defender Antivirus (MDAV) to scan your storage content, helping ensure data security and compliance.

Defender for Storage offers two types of malware scanning:

* [On-upload malware scanning](on-upload-malware-scanning.md): Scans blobs automatically when they're uploaded or modified, providing near real-time detection. This type of scanning is ideal for applications that involve frequent user uploads, such as web applications or collaborative platforms. Scanning content as it's uploaded helps reduce the risk of malicious files entering your storage environment and propagating downstream.

* [On-demand malware scanning](on-demand-malware-scanning.md): Lets you scan existing blobs whenever necessary. This scanning type is suitable for establishing a security baseline by scanning existing data, reacting to security alerts during incident response, supporting compliance needs, and performing proactive security checks across stored data.

These scanning modes help you protect your storage accounts, meet compliance needs, and maintain data integrity.

> [!NOTE]
> Scan durations can vary based on file size, file type, service load, and storage account read latency. Applications dependent on scan results should account for possible variations in scan times.

## Why malware scanning is important

Content uploaded to cloud storage can introduce malware and create security risks. Malware scanning helps prevent malicious files from entering or spreading within your environment.

Key benefits include:

* **Detecting malicious content**: Identifies and mitigates malware.
* **Enhancing security posture**: Adds a layer to prevent malware spread.
* **Supporting compliance**: Meets regulatory requirements.
* **Simplifying security management**: Provides a cloud-native, low-maintenance solution configurable at scale.

## Key features

* **Built-in SaaS solution:** Simple to enable with zero infrastructure maintenance.
* **Advanced antimalware capabilities:** Uses MDAV to detect polymorphic and metamorphic malware across all file types.
* **Comprehensive detection**: Scans all file types, including archives like ZIP and RAR files, up to 50 GB per blob.
* **Flexible scanning options:** Provides both on-upload and on-demand scanning.
* **Security alerts:** Generates detailed alerts in Microsoft Defender for Cloud.
* **Automation support:** Integrates with Logic Apps, Function Apps, and Event Grid to create automated responses to scan results.
* **Compliance and auditing:** Logs scan results for audit and compliance requirements.
* **Private endpoint support:** Supports [private endpoints](/azure/storage/common/storage-private-endpoints), reducing public internet exposure.

## Choose the right scanning option

Use **on-upload malware scanning** if you need immediate protection against malicious uploads—ideal for web applications, user-generated content, partner integrations, or shared content pipelines. For more information, see [On-upload malware scanning](on-upload-malware-scanning.md).

Use **on-demand malware scanning** when you need scanning flexibility—for establishing security baselines, responding to alerts, preparing for audits, or verifying stored data before archival or exchange. For more information, see [On-demand malware scanning](on-demand-malware-scanning.md).

## Malware scan results

Malware scan results are available through four methods. After setup, you'll see scan results as **blob index tags** for every scanned file, and as **Microsoft Defender for Cloud security alerts** when a file is identified as malicious. You can choose to disable the use of blob index tags in the Azure portal or through the REST API. You can also configure additional scan result methods, such as **Event Grid** and **Log Analytics**, which require extra configuration. The next sections describe each scan result method in more detail.

:::image type="content" source="media/defender-for-storage-malware-scan/view-and-consume-malware-scan-results.png" alt-text="Diagram showing flow of viewing and consuming malware scanning results." lightbox="media/defender-for-storage-malware-scan/view-and-consume-malware-scan-results.png":::

### Blob index tags

[Blob index tags](/azure/storage/blobs/storage-blob-index-how-to) provide searchable key-value attributes on blobs. By default, Defender for Storage writes malware scan results to two index tags on every scanned blob:

* **Scan result:** `No threats found`, `Malicious`, `Error`, or `Not scanned`
* **Scan time (UTC)**

You can choose to disable the use of blob index tags in the Azure portal or through the REST API.

Blob index tags are designed to provide concise scan results for quick filtering and automation scenarios. However, **index tags aren't tamper-resistant**. Users with permissions to modify tags can alter them, so they shouldn’t be used as a sole security control. For security-sensitive workflows, use alerts, Event Grid events, or Log Analytics instead.

:::image type="content" source="media/defender-for-storage-malware-scan/blob-index-tags.png" alt-text="Screenshot that shows an example of a blob index tag." lightbox="media/defender-for-storage-malware-scan/blob-index-tags.png":::

> [!NOTE]
> Access to index tags requires appropriate permissions. For details, see [Get, set, and update blob index tags](/azure/storage/blobs/storage-blob-index-how-to#get-set-and-update-blob-index-tags).

### Defender for Cloud security alerts

When a malicious file is detected, Microsoft Defender for Cloud generates a [security alert](alerts-overview.md#what-are-security-alerts). These alerts include details about the file, the type of malware detected, and recommended investigation and remediation steps.

Defender for Cloud security alerts are useful for investigation and automated response. You can:

* View [security alerts](https://portal.azure.com/#view/Microsoft_Azure_Security/SecurityMenuBlade/~/7) in the Azure portal by navigating to **Microsoft Defender for Cloud** > **Security alerts**.
* [Configure workflow automations](workflow-automation.md) to trigger remediation actions when alerts are generated.
* [Export security alerts](alerts-overview.md#export-alerts) to a Security Information and Event Management (SIEM) system. You can continuously export alerts to Microsoft Sentinel using the [Microsoft Sentinel connector](/azure/sentinel/connect-defender-for-cloud), or to another SIEM of your choice.

Learn more about [responding to security alerts](/azure/event-grid/custom-event-quickstart-portal#subscribe-to-custom-topic).

### Event Grid events

Event Grid provides near-real-time delivery of malware scan results for event-driven automation. This method is optional and requires additional configuration, but it offers the fastest way to trigger automated responses based on scan results.

Event Grid supports several endpoint types for processing events, including:

- **Function Apps** – Run serverless code to move, delete, quarantine, or process scanned files.

- **Webhooks** – Notify external applications or services.

- **Event Hubs and Service Bus queues** – Forward scan result events to downstream consumers or processing pipelines.

Event Grid is recommended when you need low-latency, automated workflows that react immediately to malware scan results. Learn more about [setting up Event Grid for malware scanning](advanced-configurations-for-malware-scanning.md#set-up-event-grid-for-malware-scanning).

### Log Analytics

Log Analytics provides a centralized, queryable repository for malware scan results. This method is optional and requires additional configuration, but it's ideal for compliance, auditing, and historical investigations where detailed records of scan results are needed.

When Log Analytics is enabled, every malware scan result is written to the `StorageMalwareScanningResults` table in the configured Log Analytics workspace. You can query this table to review scan outcomes, investigate patterns, or generate compliance reports.

Log Analytics is recommended for creating an audit trail or performing in-depth analysis. For low-latency automation, use blob index tags or Event Grid instead. Learn more about [setting up logging for malware scanning](advanced-configurations-for-malware-scanning.md#set-up-logging-for-malware-scanning).

> [!TIP]
> Explore malware scanning end-to-end through the Defender for Storage hands-on lab in the [Defender for Cloud Ninja training](https://github.com/Azure/Microsoft-Defender-for-Cloud/blob/main/Labs/Modules/Module%2019%20-%20Defender%20for%20Storage.md).

### Response automation

Malware scanning supports automated responses so you can react to scan results immediately and consistently. You can build automations based on blob index tags, Defender for Cloud security alerts, or Event Grid events, depending on your workflow requirements.

Common response patterns include:

- **Enabling built-in soft deletion** for malicious files, so detected malware is automatically moved or deleted without requiring custom workflows.

- **Blocking access** to unscanned or malicious files using Attribute-Based Access Control (ABAC).

- **Deleting or moving malicious files** to a quarantine location using Logic Apps triggered by security alerts, or Function Apps triggered by Event Grid events.

- **Forwarding clean files** to another storage location using Event Grid with Function Apps.

Learn more about [setting up response actions for malware scanning](defender-for-storage-configure-malware-scan.md#set-up-response-to-malware-scanning).


### Malware scanning

When malware scanning is enabled, Defender for Storage automatically deploys several Azure resources required for scanning operations:

- **Event Grid System Topic:** Created in the same resource group as the storage account. This system topic listens for blob upload events and triggers on-upload malware scanning. Removing this resource stops malware scanning from functioning.

- **`StorageDataScanner` resource:** A managed service resource created in your subscription with a system-assigned managed identity. This identity receives the **Storage Blob Data Owner** role so it can read blob data for malware scanning and Sensitive Data Discovery. It's also added to the storage account’s network ACL resource access rules to allow scanning when public network access is restricted.

- **`DefenderForStorageSecurityOperator` resource (subscription-level enablement):** Created when malware scanning is enabled at the subscription level. This identity configures, repairs, and maintains malware scanning settings across existing and newly created storage accounts. It includes the required role assignments to perform these operations.

These resources are required for malware scanning to function. If any of them are deleted or modified, malware scanning may stop working.

> [!NOTE]
> If malware scanning becomes nonfunctional due to missing resources or permissions, disable and re-enable the feature to recreate and restore its required components.

## Supported content and limitations

### Supported content

* **File types:** All file types, including archives like ZIP files.

* **File size:** Blobs up to 50 GB in size.

### Limitations

* **Unsupported storage accounts:** Legacy v1 storage accounts aren't supported.

* **Unsupported service:** Malware scanning doesn't support Azure Files.

* **Unsupported blob types:** [Append blobs and page blobs](/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs) aren't supported.

* **Unsupported encryption:** Client-side encrypted blobs can't be scanned, as the service can't decrypt them. Blobs encrypted at rest with Customer Managed Keys (CMK) are supported.

* **Unsupported protocols:** Blobs uploaded via the Network File System (NFS) 3.0 protocol aren't scanned.

* **Blob index tags:** Index tags aren't supported for storage accounts with hierarchical namespace enabled (Azure Data Lake Storage Gen2).

* **Unsupported regions:** Some regions aren't yet supported for malware scanning. The service is continuously expanding to new regions. For the latest list of supported regions, see [Defender for Cloud Availability](https://azure.microsoft.com/pricing/details/defender-for-cloud/).

* **Event Grid**: Event Grid topics that don't have public network access enabled (such as, private endpoint connections) aren't supported by malware scanning in Defender for Storage.

* **Blob may not be scanned after metadata update****:** If a blob's metadata is updated soon after upload, on-upload scanning might fail to scan the blob. To avoid this issue, it's recommended to either specify blob metadata in [BlobOpenWriteOptions](/dotnet/api/azure.storage.blobs.models.blobopenwriteoptions), or to delay the blob metadata update until after the blob is scanned.

* **Scan time limits:** Depending on size and complexity, some blobs might take a long time to scan. For example, zip files with many entries typically take a long time to scan. Defender enforces an upper limit on the amount of time allotted to scanning a single blob. This time ranges from between 30 minutes and 3 hours depending on the size of the blob. If the scan of a blob takes longer than the allotted time the scan is halted, and the scan result will be marked as "Scan timed out".

### Other costs

Azure Services: Malware scanning uses other Azure services, which might incur further costs:

* Azure Storage read operations
* Azure Storage blob indexing (To reduce the costs incurred by using blob index tags, you can disable the use of index tags for storing malware scanning results from the Azure portal or REST API)

* Azure Event Grid events

The [Microsoft Defender for Storage Price Estimation Dashboard](https://github.com/Azure/Microsoft-Defender-for-Cloud/tree/main/Workbooks/Microsoft%20Defender%20for%20Storage%20Price%20Estimation) can help you estimate the total expected cost of Defender for Storage.

### Blob scans and impact on IOPS

Each time the malware scanning service scans a file, it triggers another read operation and updates the index tag. This applies to both on-upload scanning, which occurs after the blob is uploaded or modified, and on-demand scanning. Despite these operations, access to the scanned data remains unaffected. The impact on storage Input/Output Operations Per Second (IOPS) is minimal, ensuring these operations typically don't introduce significant load. To reduce the impact on IOPS, you can disable the use of index tags for storing malware scanning results.

### Scenarios where malware scanning is ineffective

While malware scanning provides comprehensive detection capabilities, there are specific scenarios where it becomes ineffective due to inherent limitations. Evaluate these scenarios carefully before deciding to enable malware scanning on a storage account:

* **Chunked data:** Malware scanning is ineffective at detecting threats in blobs that have been divided into smaller pieces. The anti-malware engine may fail to detect any malware present. To mitigate this risk, consider other security measures, such as scanning data before chunking or after it has been fully reassembled.

* **Encrypted data:** Malware scanning doesn't support client-side encrypted data. The service can't decrypt this data, so any malware within these encrypted blobs goes undetected. If encryption is necessary, scan the data before the encryption process or use supported encryption methods like Customer Managed Keys (CMK) for encryption at rest.

* **Backup data:** Backups consist of fragments from various files. If a malicious file is backed up, it might trigger a false positive detection on the backup file, which itself isn't malicious.

When deciding to enable malware scanning, consider if other supported files are being uploaded to the storage account. Also, assess if attackers could exploit this upload stream to introduce malware.

### Differences in malware detection between Azure Storage and endpoint environments

Defender for Storage utilizes the same anti-malware engine and up-to-date signatures as Defender for Endpoint to scan for malware. However, when files are uploaded to Azure Storage, they lack certain metadata that the anti-malware engine depends on. This lack of metadata can lead to a higher rate of missed detections, known as 'false negatives,' in Azure Storage compared to detections identified by Defender for Endpoint.

The following are some examples of missing metadata:

* **Mark of the Web (MOTW):** MOTW is a Windows security feature that tracks files downloaded from the internet. However, when files are uploaded to Azure Storage, this metadata isn't preserved.

* **File path context:** On standard operating systems, the file path can provide more context for threat detection. For example, a file trying to modify system locations (for example, `C:\Windows\System32`) would be flagged as suspicious and be subject to further analysis. In Azure Storage, the context of specific file paths within the blob can't be utilized in the same way.

* **Behavioral data:** Defender for Storage analyzes the contents of files without running them. It inspects the files and might emulate their execution to check for malware. However, this approach might not detect certain types of malware that reveal their malicious nature only during execution.

## Access and data privacy

### Data access requirements

The malware scanning service requires access to your data to scan for malware. During service enablement, a new Data Scanner resource called `StorageDataScanner` is created in your Azure subscription. This resource is assigned a system-assigned managed identity and given the Storage Blob Data Owner role assignment to access and scan your data.

If your storage account networking configuration is set to Enable Public network access from selected virtual networks and IP addresses, the `StorageDataScanner` resource is added to the Resource instances section under the storage account networking configuration to allow scanning access.

### Data privacy and regional processing

* **Regional processing:** Scanning occurs within the same Azure region as your storage account to comply with data residency requirements.

* **Data handling:** Scanned files aren't stored. In some cases, file metadata (for example, SHA-256 hash) might be shared with Microsoft Defender for Endpoint for further analysis.

## Handle possible false positives and false negatives

### False positives

False positives occur when the system incorrectly identifies a benign file as malicious. To address these issues:

1. **Submit for analysis**

   * Use the [Sample Submission Portal](https://www.microsoft.com/wdsi/filesubmission) to report false positives.

   * Select "Microsoft Defender for Storage" as the source when submitting.

1. **Suppress alerts**

   * [Create suppression rules](alerts-suppression-rules.md) in Defender for Cloud to prevent specific recurring false positive alerts.

### Address undetected malware (false negatives)

False negatives occur when the system fails to detect a malicious file. If you suspect this false negative happened, you can report the undetected malware by submitting the file for analysis through the [Sample Submission Portal](https://www.microsoft.com/wdsi/filesubmission). Be sure to include as much context as possible to explain why you believe the file is malicious.

> [!NOTE]
> Regularly reporting false positives and negatives helps improve the accuracy of the malware detection system over time.

## Related content

* [On-upload malware scanning in Microsoft Defender for Storage](on-upload-malware-scanning.md)

* [On-demand malware scanning in Microsoft Defender for Storage](on-demand-malware-scanning.md)
