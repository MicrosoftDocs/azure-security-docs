---
title: Introduction to Defender for Storage malware scanning
description: Discover how malware scanning in Microsoft Defender for Storage enhances security. It improves compliance and data integrity by detecting and mitigating threats.
ms.date: 09/16/2025
author: Elazark
ms.author: elkrieger
ms.topic: how-to
#customer intent: As a security administrator, I want to understand malware scanning in Defender for Storage so that I can enhance security and compliance.
---

# Introduction to malware scanning

Malware scanning in Microsoft Defender for Storage improves the security of your Azure Storage accounts by detecting and mitigating malware threats. It uses Microsoft Defender Antivirus (MDAV) to scan your storage content, helping ensure data security and compliance.

Defender for Storage offers two types of malware scanning:

* [On-upload malware scanning](on-upload-malware-scanning.md): Scans blobs automatically when they're uploaded or modified, providing fast detection. This type of scanning is ideal for applications that involve frequent user uploads, such as web applications or collaborative platforms. Scanning content as it's uploaded helps reduce the risk of malicious files entering your storage environment and propagating downstream.

* [On-demand malware scanning](on-demand-malware-scanning.md): Lets you manually scan existing blobs whenever needed. This scanning type is used to establish a security baseline for stored data, respond to security alerts during incident response, support compliance requirements, and perform proactive security checks across your environment.

These scanning modes help you protect your storage accounts, meet compliance needs, and maintain data integrity.

> [!NOTE]
> Scan durations can vary based on file size, file type, service load, and storage account read latency. Applications dependent on scan results should account for possible variations in scan times.

## Why malware scanning is important

Content uploaded to cloud storage can introduce malware and create security risks. Malware scanning helps prevent malicious files from entering or spreading within your environment.

Key benefits include:

* **Detecting malicious content**: Identifies and mitigates malware.
* **Enhancing security posture**: Adds a layer to prevent malware spread.
* **Supporting compliance**: Meets regulatory requirements.
* **Simplifying security management**: Provides a cloud-native, low-maintenance solution configurable at scale.

## Key features

* **Built-in SaaS solution:** Simple to enable with zero infrastructure maintenance.
* **Advanced antimalware capabilities:** Uses MDAV to detect polymorphic and metamorphic malware across all file types.
* **Comprehensive detection**: Scans all file types, including archives like ZIP and RAR files, up to 50 GB per blob.
* **Flexible scanning options:** Provides both on-upload and on-demand scanning.
* **Security alerts:** Generates detailed alerts in Microsoft Defender for Cloud.
* **Automation support:** Integrates with Logic Apps, Function Apps, and Event Grid to create automated responses to scan results.
* **Compliance and auditing:** Logs scan results for audit and compliance requirements.
* **Private endpoint support:** Supports [private endpoints](/azure/storage/common/storage-private-endpoints), reducing public internet exposure.
* **Automated malware remediation**: Soft-deletes malicious blobs detected through on-upload and on-demand malware scanning.

## Choose the right scanning option

Use **on-upload malware scanning** if you need protection against malicious uploads—ideal for web applications, user-generated content, partner integrations, or shared content pipelines. For more information, see [On-upload malware scanning](on-upload-malware-scanning.md).

Use **on-demand malware scanning** when you need scanning flexibility—for establishing security baselines, responding to alerts, preparing for audits, or verifying stored data before archival or exchange. For more information, see [On-demand malware scanning](on-demand-malware-scanning.md).

## Malware scan results

Malware scan results are available through four methods. After setup, you'll see scan results as **blob index tags** for every scanned file, and as **Microsoft Defender for Cloud security alerts** when a file is identified as malicious. You can choose to disable the use of blob index tags in the Azure portal or through the REST API. You can also configure additional scan result methods, such as **Event Grid** and **Log Analytics**, which require extra configuration. The next sections describe each scan result method in more detail.

:::image type="content" source="media/defender-for-storage-malware-scan/view-and-consume-malware-scan-results.png" alt-text="Diagram showing flow of viewing and consuming malware scanning results." lightbox="media/defender-for-storage-malware-scan/view-and-consume-malware-scan-results.png":::

### Blob index tags

[Blob index tags](/azure/storage/blobs/storage-blob-index-how-to) provide searchable key-value attributes on blobs. By default, Defender for Storage writes malware scan results to two index tags on every scanned blob:

* **Scan result:** `No threats found`, `Malicious`, `Error`, or `Not scanned`
* **Scan time (UTC)**

You can choose to disable the use of blob index tags in the Azure portal or through the REST API.

Blob index tags are designed to provide concise scan results for quick filtering and automation scenarios. However, index tags aren't tamper-resistant. Users with permissions to modify tags can alter them, so they shouldn’t be used as a sole security control. For security-sensitive workflows, use alerts, Event Grid events, or Log Analytics instead.

:::image type="content" source="media/defender-for-storage-malware-scan/blob-index-tags.png" alt-text="Screenshot that shows an example of a blob index tag." lightbox="media/defender-for-storage-malware-scan/blob-index-tags.png":::

> [!NOTE]
> Access to index tags requires appropriate permissions. For details, see [Get, set, and update blob index tags](/azure/storage/blobs/storage-blob-index-how-to#get-set-and-update-blob-index-tags).

### Defender for Cloud security alerts

When a malicious file is detected, Microsoft Defender for Cloud generates a [security alert](alerts-overview.md#what-are-security-alerts). These alerts include details about the file, the type of malware detected, and recommended investigation and remediation steps.

Defender for Cloud security alerts are useful for investigation and automated response. You can:

* View [security alerts](https://portal.azure.com/#view/Microsoft_Azure_Security/SecurityMenuBlade/~/7) in the Azure portal by navigating to **Microsoft Defender for Cloud** > **Security alerts**.
* [Configure workflow automations](workflow-automations.md) to trigger remediation actions when alerts are generated.
* [Export security alerts](alerts-overview.md#export-alerts) to a Security Information and Event Management (SIEM) system. You can continuously export alerts to Microsoft Sentinel using the [Microsoft Sentinel connector](/azure/sentinel/connect-defender-for-cloud), or to another SIEM of your choice.

Learn more about [responding to security alerts](/azure/event-grid/custom-event-quickstart-portal#subscribe-to-custom-topic).

### Event Grid events

Event Grid provides near-real-time delivery of malware scan results for event-driven automation. This method is optional and requires additional configuration, but it offers the fastest way to trigger automated responses based on scan results.

Event Grid supports several endpoint types for processing events, including:

- **Function Apps** – Run serverless code to move, delete, quarantine, or process scanned files.

- **Webhooks** – Notify external applications or services.

- **Event Hubs and Service Bus queues** – Forward scan result events to downstream consumers or processing pipelines.

Event Grid is recommended when you need low-latency, automated workflows that react immediately to malware scan results. Learn more about [setting up Event Grid for malware scanning](advanced-configurations-for-malware-scanning.md#set-up-event-grid-for-malware-scanning).

### Log Analytics

Log Analytics provides a centralized, queryable repository for malware scan results. This method is optional and requires additional configuration, but it's ideal for compliance, auditing, and historical investigations where detailed records of scan results are needed.

When Log Analytics is enabled, every malware scan result is written to the `StorageMalwareScanningResults` table in the configured Log Analytics workspace. You can query this table to review scan outcomes, investigate patterns, or generate compliance reports.

Log Analytics is recommended for creating an audit trail or performing in-depth analysis. For low-latency automation, use blob index tags or Event Grid instead. Learn more about [setting up logging for malware scanning](advanced-configurations-for-malware-scanning.md#set-up-logging-for-malware-scanning).

> [!TIP]
> Explore malware scanning end-to-end through the Defender for Storage hands-on lab in the [Defender for Cloud Ninja training](https://github.com/Azure/Microsoft-Defender-for-Cloud/blob/main/Labs/Modules/Module%2019%20-%20Defender%20for%20Storage.md).

### Automated malware remediation

Malware scanning supports automated responses so you can react to scan results immediately and consistently. You can build automations based on blob index tags, Defender for Cloud security alerts, or Event Grid events, depending on your workflow requirements.

Common response patterns include:

- **Enabling built-in soft deletion** for malicious files, so detected malware is automatically moved or deleted without requiring custom workflows.

- **Blocking access** to unscanned or malicious files using Attribute-Based Access Control (ABAC).

- **Deleting or moving malicious files** to a quarantine location using Logic Apps triggered by security alerts, or Function Apps triggered by Event Grid events.

- **Forwarding clean files** to another storage location using Event Grid with Function Apps.

Learn more about [setting up response actions for malware scanning](defender-for-storage-configure-malware-scan.md).

## Resources deployed by malware scanning

When malware scanning is enabled, Defender for Storage automatically deploys several Azure resources required for scanning operations:

- **Event Grid System Topic:** Created in the same resource group as the storage account. This system topic listens for blob upload events and triggers on-upload malware scanning. Removing this resource stops malware scanning from functioning.

- **`StorageDataScanner` resource:** A managed service resource created in your subscription with a system-assigned managed identity. This identity receives the **Storage Blob Data Owner** role so it can read blob data for malware scanning and Sensitive Data Discovery. It's also added to the storage account’s network access control list (ACL) rules to allow scanning when public network access is restricted.

- **`DefenderForStorageSecurityOperator` resource (subscription-level enablement):** Created when malware scanning is enabled at the subscription level. This identity configures, repairs, and maintains malware scanning settings across existing and newly created storage accounts. It includes the required role assignments to perform these operations.

These resources are required for malware scanning to function. If any of them are deleted or modified, malware scanning might stop working.

> [!NOTE]
> If malware scanning becomes nonfunctional due to missing resources or permissions, disable and re-enable the feature to recreate and restore its required components.

## Supported content and limitations

### Supported content

* **File types:** All file types are supported, including compressed archives such as ZIP and RAR files.

* **File size:** Blobs up to 50 GB can be scanned.

### Limitations

* **Unsupported storage accounts:** Legacy v1 storage accounts aren’t supported.  

* **Unsupported services:** Azure Files isn’t supported.  

* **Unsupported blob types:** [Append blobs and page blobs](/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs) aren't supported.

* **Unsupported client-side encryption:** Client-side encrypted blobs can't be scanned, as the service can't decrypt them. Blobs encrypted at rest with Customer Managed Keys (CMK) are supported.

* **Unsupported protocols:** Blobs uploaded using the Network File System (NFS) 3.0 protocol aren’t scanned.  

* **Blob index tags:** Index tags aren’t supported for storage accounts with hierarchical namespaces enabled (Azure Data Lake Storage Gen2).  

* **Unsupported regions:** Not all regions currently support malware scanning. For the latest list, see [Defender for Cloud availability](https://azure.microsoft.com/pricing/details/defender-for-cloud/).  

* **Event Grid:** Event Grid topics that don’t have public network access enabled (for example, those using private endpoints) aren’t supported for scan-result delivery.  

* **Metadata update timing:** If a blob’s metadata is updated soon after upload, on-upload scanning might fail. To avoid this, it's recommended to either specify metadata in [`BlobOpenWriteOptions`](/dotnet/api/azure.storage.blobs.models.blobopenwriteoptions), or to delay metadata updates until scanning completes.  

* **Scan time limits:** Large or complex blobs might exceed Defender’s scanning timeout window (30 minutes to 3 hours, depending on blob size and structure). For example, ZIP files with many nested entries typically take longer to scan. If a scan exceeds the allotted time, the result is marked as **Scan timed out**.

## Performance and cost considerations  

### Blob scans and impact on IOPS

Each malware scan performs an additional read operation and updates blob index tags. These operations generate extra I/O but typically have minimal impact on storage performance (IOPS). Access to the scanned data remains unaffected during scanning, and applications can continue reading or writing to the blob without interruption.

You can reduce IOPS impact by disabling blob index tags for scan-result storage.

### Additional costs

Malware scanning might incur additional costs from dependent Azure services, including:

* Azure Storage read operations  
* Azure Storage blob indexing (if index tags are used)  
* Azure Event Grid events  

Use the [Microsoft Defender for Storage Price Estimation dashboard](https://github.com/Azure/Microsoft-Defender-for-Cloud/tree/main/Workbooks/Microsoft%20Defender%20for%20Storage%20Price%20Estimation) to estimate end-to-end costs.

## Scenarios where malware scanning is ineffective

While malware scanning provides broad detection capabilities, certain data patterns or upload scenarios prevent the service from accurately identifying malware. Consider these cases before enabling malware scanning on a storage account:

* **Chunked data:** Detection might fail when a file is uploaded in fragments. Header-only fragments are marked as corrupt, while tail-only fragments might appear benign. Scan data before chunking or after reassembly to ensure coverage.

* **Encrypted data:** Malware scanning doesn't support client-side encrypted data. The service can't decrypt this data, so any malware within these encrypted blobs goes undetected. If encryption is required, scan data before encrypting it, or use supported encryption-at-rest methods such as customer-managed keys (CMK), where Azure Storage handles decryption for access.

* **Backup data:** Backup files might contain fragments of previously scanned or malicious content. Because the scanner evaluates the fragment itself rather than the original file context, backups might generate alerts even though the backup file as a whole isn’t malicious.

Evaluate these scenarios as part of your threat model, particularly if untrusted or user-generated content can be uploaded to the storage account.

## Detection differences between storage and endpoint environments

Defender for Storage uses the same anti-malware engine and signature updates as Defender for Endpoint. However, when files are scanned in Azure Storage, certain contextual metadata available on endpoints isn't present. This lack of context can result in a higher likelihood of missed detections (false negatives) compared to scanning on an endpoint.

Examples of missing or unavailable context include:

* **Mark of the Web (MOTW):** MOTW identifies files that originated from the internet, but this metadata isn’t preserved when files are uploaded to Azure Storage.

* **File path context:** Endpoint scanning evaluates the file path to determine whether a file is interacting with sensitive system locations (such as `C:\Windows\System32`). Blob storage doesn't provide equivalent path-based context.

* **Behavioral data:** Defender for Storage performs static analysis and limited emulation but doesn't observe runtime behavior. Some malware only reveals malicious behavior during execution and might not be detected through static inspection alone.

## Access and data privacy

### Data access requirements

To scan data for malware, the service requires access to the blobs within your storage account. When malware scanning is enabled, Azure automatically deploys a resource named `StorageDataScanner` in your subscription. This resource uses a system-assigned managed identity and is granted the **Storage Blob Data Owner** role to read and scan data.

If your storage account is configured to allow public network access only from selected virtual networks or IP addresses, the `StorageDataScanner` resource is added to the **Resource instances** section of the storage account networking configuration. This ensures the scanner can access your data even when public network access is restricted.

### Data privacy and regional processing

* **Regional processing:** Malware scanning is performed in the same Azure region as your storage account to support data residency and compliance requirements.

* **Data handling:** Scanned files aren't stored by the service. In limited cases, file metadata such as the SHA-256 hash might be shared with Microsoft Defender for Endpoint for further analysis.

## Handle false positives and false negatives

### False positives

A false positive occurs when a benign file is incorrectly identified as malicious. If you believe a file was incorrectly flagged, you can take the following actions:

1. **Submit the file for reanalysis**

   Use the [Sample Submission Portal](https://www.microsoft.com/wdsi/filesubmission) to report a false positive.  
   When submitting, select **Microsoft Defender for Storage** as the source.

2. **Suppress repeated alerts**

   Create [alert suppression rules](alerts-suppression-rules.md) in Defender for Cloud to reduce noise from recurring false positive alerts in your environment.

### Address undetected malware (false negatives)

A false negative occurs when a malicious file isn't detected. If you believe malware was missed, submit the file for analysis through the [Sample Submission Portal](https://www.microsoft.com/wdsi/filesubmission). Provide as much context as possible to support why you believe the file is malicious.

> [!NOTE]
> Reporting false positives and false negatives helps improve detection accuracy over time.

## Related content

* [On-upload malware scanning in Microsoft Defender for Storage](on-upload-malware-scanning.md)

* [On-demand malware scanning in Microsoft Defender for Storage](on-demand-malware-scanning.md)
