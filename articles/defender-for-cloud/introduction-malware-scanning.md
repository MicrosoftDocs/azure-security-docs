---
title: Introduction to malware scanning in Microsoft Defender for Storage
description: Discover how malware scanning in Microsoft Defender for Storage enhances security and compliance.
ms.date: 10/13/2024
author: dcurwin
ms.author: dacurwin
ms.topic: how-to
---


# Introduction to malware scanning

Malware scanning in Microsoft Defender for Storage improves the security of your Azure Storage accounts by detecting and mitigating malware threats. It uses Microsoft Defender Antivirus to scan your storage content, ensuring security and compliance.

Defender for Storage offers two types of malware scanning:

* **On-upload malware scanning**: Scans blobs automatically when they're uploaded or modified, providing near real-time detection. This type of scanning is ideal for applications that involve frequent user uploads, such as web applications or collaborative platforms. Scanning content as it is uploaded helps prevent malicious files from entering your storage environment and propagated downstream.

* **On-demand malware scanning**: Lets you scan existing blobs whenever necessary, making it ideal for incident response, compliance, and proactive security. This scanning type is perfect for establishing a security baseline by scanning all existing data, reacting to security alerts, or preparing for audits.

These options help you protect your storage accounts, meet compliance needs, and maintain data integrity.

## Why malware scanning is important

Content uploaded to cloud storage can introduce malware, posing risks to your organization. Scanning content for malware helps prevent malicious files from entering or spreading within your environment.

Malware scanning in Defender for Storage helps by:

* **Detecting malicious content**: Identifies and mitigates malware threats.

* **Enhancing security posture**: Adds a security layer to prevent malware spread.

* **Supporting compliance**: Helps meet regulatory requirements.

* **Simplifying security management**: Offers a cloud-native, low-maintenance solution configurable at scale.

## Key features

* **Comprehensive detection**: Scans all file types, including archives like ZIP and RAR files, up to 2 GB per blob.

* **Flexible scanning options**: Offers on-upload and on-demand scanning based on your needs.

* **Integration with security alerts**: Generates detailed alerts in Microsoft Defender for Cloud.

* **Support for automation**: Enables automated responses using Azure services like Logic Apps and Function Apps.

* **Compliance and auditing**: Logs scan results for compliance and auditing.

## Common use cases and scenarios

### On-upload malware scanning

On-upload malware scanning is ideal for applications where content is uploaded frequently, and protection is needed in real time. Here are some common scenarios:

#### Top three scenarios for on-upload scanning

* **Web applications**: Automatically scan user-uploaded content for security, such as tax apps or HR sites, ensuring malicious files are blocked before they enter the environment.

* **Content protection**: Protect shared assets like videos and photos from becoming malware distribution points, maintaining the integrity of multimedia repositories.

* **Compliance requirements**: Ensure uploads are compliant with regulations by scanning content in regulated industries or regions, such as healthcare or finance.

#### More scenarios for on-upload scanning

In addition to these scenarios, on-upload scanning serves a wide range of other use cases:

* **Third-party integration**: Scan data from external partners or vendors to prevent introducing security risks.

* **Collaborative platforms**: Safeguard content shared across teams and organizations, ensuring a safe collaboration environment.

* **Data pipelines**: Maintain the integrity of ETL (Extract, Transform, Load) pipelines by scanning incoming data for malicious content.

* **Machine learning training data**: Verify that large datasets used for machine learning are malware-free, preventing model corruption.

### On-demand malware scanning

On-demand scanning provides flexibility to initiate scans based on specific needs, making it an effective tool for a wide range of scenarios.

#### Top three scenarios for on-demand scanning

* **Incident response and automated security**: Use on-demand scanning to respond to security alerts or suspicious activities. Integrate with automation tools like Logic Apps to run playbooks automatically based on security triggers.

* **Regulatory compliance**: Schedule regular scans to comply with industry regulations and prepare for audits, especially in sectors with strict data handling requirements.

* **Proactive operational security**: Maintain a secure environment by scheduling recurring scans of all stored data, detecting malware even after the data is stored.

#### More scenarios for on-demand scanning

Other useful cases for on-demand scanning include:

* **Initial data security assessment**: When first enabling Defender for Storage, scan existing data to establish a security baseline.

* **Customer assurance**: Run scans to prove to customers or auditors that your environment is malware-free.

* **Secure data exchange**: Ensure files are free of malware before exchanging them with external entities.

* **Archival data integrity**: Scan data before archiving or reintegrating it into active storage environments to ensure it's free of malicious content.

### Other costs

Azure Services: Malware scanning uses other Azure services, which might incur further costs:

* Azure Storage read operations

* Azure Storage blob indexing

* Azure Event Grid notifications

#### Blob uploads and index tag updates

When a blob is uploaded to the storage account, malware scanning initiates an extra read operation and updates the index tag. In most cases, these operations don't generate significant load.

## Viewing and consuming scan results

### Scan results methods

After setup, scan results are available through several methods:

* [Blob index tags](/azure/storage/blobs/storage-blob-index-how-to): Metadata fields on a blob, indicating malware scanning results and scan time. These tags are automatically indexed but aren't tamper-resistant.

   :::image type="content" source="media/defender-for-storage-malware-scan/blob-index-tags.png" alt-text="Screenshot that shows an example of a blob index tag." lightbox="media/defender-for-storage-malware-scan/blob-index-tags.png":::

* **Defender for Cloud security alerts:** When a malicious file is detected, [security alerts](alerts-overview.md#what-are-security-alerts) are generated in Microsoft Defender for Cloud with details on the file, malware type, and remediation steps.

* **Event Grid events:** Provides event-driven automation with low latency, suitable for automating response workflows.

* **Log Analytics workspace:** Store scan results for compliance and investigation purposes. Logs can be viewed in the Log Analytics destination workspace under the `StorageMalwareScanningResults` table.

:::image type="content" source="media/defender-for-storage-malware-scan/view-and-consume-malware-scan-results.png" alt-text="Diagram showing flow of viewing and consuming malware scanning results." lightbox="media/defender-for-storage-malware-scan/view-and-consume-malware-scan-results.png":::

## Supported content and limitations

### Supported content

* **File types:** All file types, including archives like ZIP files.

* **File size:** Blobs up to 2 GB in size.

### Limitations

* **Unsupported storage accounts:** Legacy v1 storage accounts aren't supported.

* **Unsupported blob types:** [Append blobs and page blobs](/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs) aren't supported.

* **Unsupported encryption:** Client-side encrypted blobs can't be scanned, as the service can't decrypt them. Blobs encrypted at rest with Customer Managed Keys (CMK) are supported.

* **Unsupported protocols:** Blobs uploaded via the Network File System (NFS) 3.0 protocol aren't scanned.

* **Blob index tags:** Index tags aren't supported for storage accounts with hierarchical namespace enabled (Azure Data Lake Storage Gen2).

* **Unsupported regions:** Certain regions aren't supported for malware scanning. Learn more about [availability for Defender for Storage.](defender-for-storage-introduction.md).

* **Chunked data:** Malware scanning doesn't effectively detect malware in blobs that contain chunked data, for example, files split into smaller parts. This issue is common in backup services that upload backup data in chunks to storage accounts. The scanning process might miss malicious content or incorrectly flag clean content, leading to false negatives and false positives. To mitigate this risk, consider implementing further security measures, such as scanning data before it's chunked or after it's fully reassembled.

* **Impact on access:** Access to blobs remains unaffected during scanning, and the impact on storage Input/Output Operations Per Second (IOPS) is minimal.

### Limitations compared to Microsoft Defender for Endpoint

Defender for Storage utilizes the same antimalware engine and up-to-date signatures as Defender for Endpoint to scan for malware. However, when files are uploaded to Azure Storage, they lack certain metadata that the antimalware engine depends on. This lack of metadata can lead to a higher rate of missed detections, known as 'false negatives,' in Azure Storage compared to those detections identified by Defender for Endpoint.

The following are some examples of missing metadata:

* **Mark of the Web (MOTW):** MOTW is a Windows security feature that tracks files downloaded from the internet. However, when files are uploaded to Azure Storage, this metadata isn't preserved.

* **File path context:** On standard operating systems, the file path can provide more context for threat detection. For example, a file trying to modify system locations (for example, `C:\Windows\System32`) would be flagged as suspicious and be subject to further analysis. In Azure Storage, the context of specific file paths within the blob can't be utilized in the same way.

* **Behavioral data:** Defender for Storage analyzes the contents of files without running them. It inspects the files and might emulate their execution to check for malware. However, this approach might not detect certain types of malware that reveal their malicious nature only during execution.

## Access and data privacy

### Data access requirements

The Malware Scanning service requires access to your data to scan for malware. During service enablement, a new Data Scanner resource called `StorageDataScanner` is created in your Azure subscription. This resource is assigned a system-assigned managed identity and given the Storage Blob Data Owner role assignment to access and scan your data.

If your storage account networking configuration is set to Enable Public network access from selected virtual networks and IP addresses, the `StorageDataScanner` resource is added to the Resource instances section under the storage account networking configuration to allow scanning access.

### Data privacy and regional processing

* **Regional processing:** Scanning occurs within the same Azure region as your storage account to comply with data residency requirements.

* **Data handling:** Scanned files aren't stored. In some cases, file metadata (for example, SHA-256 hash) might be shared with Microsoft Defender for Endpoint for further analysis.

* **Private endpoint support:** Malware scanning supports private endpoints, ensuring data privacy by eliminating public internet exposure.

## Handling possible false positives and false negatives

### False positives

False positives occur when the system incorrectly identifies a benign file as malicious. To address these issues:

1. **Submit for analysis**

   * Use the [Sample Submission Portal](https://www.microsoft.com/wdsi/filesubmission) to report false positives.

   * Select "Microsoft Defender for Storage" as the source when submitting.

1. **Suppress alerts**

   * [Create suppression rules](alerts-suppression-rules.md) in Defender for Cloud to prevent specific recurring false positive alerts.

### False negatives

False negatives happen when the system fails to detect an actually malicious file. If you suspect this has occurred:

### Report undetected malware

* If you believe a file is malicious but wasn't flagged by the system, submit it for analysis through the same [Sample Submission Portal](https://www.microsoft.com/wdsi/filesubmission).

* Provide as much context as possible about why you suspect the file to be malicious.

> [!NOTE]
> Regularly reporting false positives and negatives helps improve the accuracy of the malware detection system over time.

## Related content

* [On-upload malware scanning in Microsoft Defender for Storage](on-upload-malware-scanning.md)
* [On-demand malware scanning in Microsoft Defender for Storage](on-demand-malware-scanning.md)
