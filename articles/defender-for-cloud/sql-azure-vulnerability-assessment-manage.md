---
title: Manage vulnerability findings in your Azure SQL databases
description: Learn how to remediate software vulnerabilities and disable findings with the express configuration.
author: dcurwin
ms.author: dacurwin
ms.date: 06/14/2023
ms.service: defender-for-cloud
ms.custom: devx-track-azurecli
ms.topic: how-to
---

# Manage vulnerability findings in your Azure SQL databases

Microsoft Defender for Cloud provides [vulnerability assessment](sql-azure-vulnerability-assessment-overview.md) for your Azure SQL databases. Vulnerability assessment scans your databases for software vulnerabilities and provides a list of findings. You can use the findings to remediate software vulnerabilities and disable findings.

## Prerequisites

Make sure that you know whether you're using the [express or classic configurations](sql-azure-vulnerability-assessment-overview.md#what-are-the-express-and-classic-configurations) before you continue.

To see which configuration you're using:

1. In the [Azure portal](https://portal.azure.com), open the specific resource in Azure SQL Database, SQL Managed Instance Database, or Azure Synapse.
1. Under the **Security** heading, select **Defender for Cloud**.
1. In the **Enablement Status**, select **Configure** to open the Microsoft Defender for SQL settings pane for either the entire server or managed instance.

If the vulnerability settings show the option to configure a storage account, you're using the classic configuration. If not, you're using the express configuration.

- [Express configuration](#express-configuration)
- [Classic configuration](#classic-configuration)

## Express configuration

### View scan history

Select **Scan History** in the vulnerability assessment pane to view a history of all scans previously run on this database.

Express configuration doesn't store scan results if they're identical to previous scans. The scan time shown in the scan history is the time of the last scan where the scan results changed.

### Disable specific findings from Microsoft Defender for Cloud (preview)

If you have an organizational need to ignore a finding rather than remediate it, you can disable the finding. Disabled findings don't impact your secure score or generate unwanted noise. You can see the disabled finding in the "Not applicable" section of the scan results.

When a finding matches the criteria you've defined in your disable rules, it won't appear in the list of findings. Typical scenarios might include:

- Disable findings with medium or lower severity
- Disable findings that are non-patchable
- Disable findings from benchmarks that aren't of interest for a defined scope

> [!IMPORTANT]
> To disable specific findings, you need permissions to edit a policy in Azure Policy. Learn more in Azure RBAC permissions in Azure Policy.

To create a rule:

1. From the recommendations detail page for Vulnerability assessment findings on your SQL servers on machines should be remediated, select Disable rule.
1. Select the relevant scope.
1. Define your criteria. You can use any of the following criteria:

    - Finding ID
    - Severity
    - Benchmarks

1. Create a disable rule for VA findings on SQL servers on machines
1. Select Apply rule. Changes might take up to 24 hours to take effect.
1. To view, override, or delete a rule:
    1. Select Disable rule.
    1. From the scope list, subscriptions with active rules show as Rule applied.
    1. To view or delete the rule, select the ellipsis menu ("...").

### Configure email notifications using Azure Logic Apps

To receive regular updates of the vulnerability assessment status for your database, you can use the [customizable Azure Logic Apps template](https://github.com/Azure/Microsoft-Defender-for-Cloud/tree/main/Workflow%20automation/Notify-SQLVulnerabilityReport).

Using the template will allow you to:

- Choose the timing of the email reports.
- Have a consistent view of your vulnerability assessment status that includes disabled rules.
- Send reports for Azure SQL Servers and SQL VMs.
- Customize report structure and look-and-feel to match your organizational standards.

### Manage vulnerability assessments programmatically

The express configuration is supported in the latest REST API version with the following functionality:

| Description                                                   | Scope           | API                                                                                                                                                                                                                                                      |
| :------------------------------------------------------------ | :-------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Baseline bulk operations                                      | System Database | [Sql Vulnerability Assessment Baselines](/rest/api/sql/2022-05-01-preview/sql-vulnerability-assessment-baselines)<br>[Sql Vulnerability Assessment Baseline](/rest/api/sql/2022-05-01-preview/sql-vulnerability-assessment-baselines)                    |
| Baseline bulk operations                                      | User Database   | [Database Sql Vulnerability Assessment Baselines](/rest/api/sql/2022-05-01-preview/database-sql-vulnerability-assessment-baselines)                                                                                                                      |
| Single rule baseline operations                               | User Database   | [Database Sql Vulnerability Assessment Rule Baselines](/rest/api/sql/2022-05-01-preview/database-sql-vulnerability-assessment-rule-baselines)                                                                                                            |
| Single rule baseline operations                               | System Database | [Sql Vulnerability Assessment Rule Baselines](/rest/api/sql/2022-05-01-preview/sql-vulnerability-assessment-rule-baselines)<br>[Sql Vulnerability Assessment Rule Baseline](/rest/api/sql/2022-05-01-preview/sql-vulnerability-assessment-rule-baseline) |
| Single scan results                                           | User Database   | [Database Sql Vulnerability Assessment Scan Result](/rest/api/sql/2022-05-01-preview/database-sql-vulnerability-assessment-scan-result)                                                                                                                  |
| Single scan results                                           | System Database | [Sql Vulnerability Assessment Scan Result](/rest/api/sql/2022-05-01-preview/sql-vulnerability-assessment-scan-result)                                                                                                                                    |
| Scan details (summary)                                        | User Database   | [Database Sql Vulnerability Assessment Scans](/rest/api/sql/2022-05-01-preview/database-sql-vulnerability-assessment-scans)                                                                                                                              |
| Scan details (summary)                                        | System Database | [Sql Vulnerability Assessment Scans](/rest/api/sql/2022-05-01-preview/sql-vulnerability-assessment-scans)                                                                                                                                                |
| Execute manual scan                                           | User Database   | [Database Sql Vulnerability Assessment Execute Scan](/rest/api/sql/2022-05-01-preview/database-sql-vulnerability-assessment-execute-scan)                                                                                                                |
| Execute manual scan                                           | System Database | [Sql Vulnerability Assessment Execute Scan](/rest/api/sql/2022-05-01-preview/sql-vulnerability-assessment-execute-scan)                                                                                                                                  |
| VA settings (GET only is supported for Express Configuration) | User Database   | [Database Sql Vulnerability Assessments Settings](/rest/api/sql/2022-05-01-preview/database-sql-vulnerability-assessments-settings)                                                                                                                      |
| VA Settings operations                                        | Server          | [Sql Vulnerability Assessments Settings](/rest/api/sql/2022-05-01-preview/sql-vulnerability-assessments-settings)<br>[Sql Vulnerability Assessments](/rest/api/sql/2022-05-01-preview/sql-vulnerability-assessments)                                      |

#### Use Azure Resource Manager templates

Use the [following ARM template](https://github.com/Azure/azure-quickstart-templates/blob/master/quickstarts/microsoft.sql/sql-logical-server/azuredeploy.json) to create a new Azure SQL Logical Server with express configuration for SQL vulnerability assessment.

To configure vulnerability assessment baselines by using Azure Resource Manager templates, use the `Microsoft.Sql/servers/databases/sqlVulnerabilityAssessments/baselines` type. Make sure that `vulnerabilityAssessments` is enabled before you add baselines.

Here are several examples to how you can set up baselines using ARM templates:

- Setup batch baseline based on latest scan results:

    ```json
    {
        "type": "Microsoft.Sql/servers/databases/sqlVulnerabilityAssessments/baselines",
        "apiVersion": "2022-02-01-preview",
        "name": "[concat(parameters('serverName'),'/', parameters('databaseName') , '/default/default')]",
        "properties": {
            "latestScan": true
            }
    }
    ```

- Setup batch baseline based on specific results:

    ```json
    {
        "type": "Microsoft.Sql/servers/databases/sqlVulnerabilityAssessments/baselines",
        "apiVersion": "2022-02-01-preview",
        "name": "[concat(parameters('serverName'),'/', parameters('databaseName') , '/default/default')]",
        "properties": {
            "latestScan": false,
            "results": {
            "VA2065": [
                [
                     "FirewallRuleName3",
                         "62.92.15.67",
                         "62.92.15.67"
                ],
                [
                     "FirewallRuleName4",
                         "62.92.15.68",
                         "62.92.15.68"
                ]
            ],
            "VA2130": [
                [
                     "dbo"
                ]
            ]
         }
      }
   }
    ```

- Set up baseline for a specific rule:

    ```json
    {
        "type": "Microsoft.Sql/servers/databases/sqlVulnerabilityAssessments/baselines/rules",
        "apiVersion": "2022-02-01-preview",
        "name": "[concat(parameters('serverName'),'/', parameters('databaseName') , '/default/default/VA1143')]",
        "properties": {
        "latestScan": false,
        "results": [
            [ "True" ]
            ]
        }
    }
    ```

- Set up batch baselines on the master database based on latest scan results:

    ```json
    {
        "type": "Microsoft.Sql/servers/databases/sqlVulnerabilityAssessments/baselines",
        "apiVersion": "2022-02-01-preview",
        "name": "[concat(parameters('serverName'),'/master/default/default')]",
        "properties": {
            "latestScan": true
            }
    }
    ```

#### Using PowerShell

Express configuration isn't supported in PowerShell cmdlets but you can use PowerShell to invoke the latest vulnerability assessment capabilities using REST API, for example:

- [Enable express configuration](powershell-sample-vulnerability-assessment-azure-sql.md) on an Azure SQL Server
- [Setup baselines](powershell-sample-vulnerability-assessment-baselines.md) based on latest scan results for all databases in an Azure SQL Server
- [Express configuration PowerShell commands reference](express-configuration-powershell-commands.md)

## Using Azure CLI

Invoke express configuration using [Azure CLI](express-configuration-azure-commands.md).

### Troubleshooting

#### Revert back to the classic configuration

To change an Azure SQL database from the express vulnerability assessment configuration to the classic configuration:

1. Disable the Defender for Azure SQL plan from the Azure portal.
1. Use PowerShell to reconfigure using the classic experience:

   ```powershell
   Update-AzSqlServerAdvancedThreatProtectionSetting `
               -ResourceGroupName "demo-rg" `
               -ServerName "dbsrv1" `
               -Enable 1
   Update-AzSqlServerVulnerabilityAssessmentSetting `
               -ResourceGroupName "demo-rg" `
               -ServerName "dbsrv1" `
               -StorageAccountName "mystorage" `
               -RecurringScansInterval Weekly `
               -ScanResultsContainerName "vulnerability-assessment"
   ```

   You might have to tweak `Update-AzSqlServerVulnerabilityAssessmentSetting` according to [Store Vulnerability Assessment scan results in a storage account accessible behind firewalls and VNets](/azure/azure-sql/database/sql-database-vulnerability-assessment-storage).

#### Errors

“Vulnerability Assessment is enabled on this server or one of its underlying databases with an incompatible version”

Possible causes:

- Switching to express configuration failed due to a server policy error.

   **Solution**: Try again to enable the express configuration. If the issue persists, try to disable the Microsoft Defender for SQL in the Azure SQL resource, select **Save**, enable Microsoft Defender for SQL again, and select **Save**.

- Switching to express configuration failed due to a database policy error. Database policies aren't visible in the Azure portal for Defender for SQL vulnerability assessment, so we check for them during the validation stage of switching to express configuration.

   **Solution**: Disable all database policies for the relevant server and then try to switch to express configuration again.

- Consider using the [provided PowerShell script](powershell-sample-vulnerability-assessment-azure-sql.md) for assistance.

## Classic configuration

### View scan history

Select **Scan History** in the vulnerability assessment pane to view a history of all scans previously run on this database.

### Disable specific findings from Microsoft Defender for Cloud (preview)

If you have an organizational need to ignore a finding, rather than remediate it, you can optionally disable it. Disabled findings don't impact your secure score or generate unwanted noise.

When a finding matches the criteria you've defined in your disable rules, it won't appear in the list of findings.
Typical scenarios might include:

- Disable findings with medium or lower severity
- Disable findings that are non-patchable
- Disable findings from benchmarks that aren't of interest for a defined scope

> [!IMPORTANT]
>
> - To disable specific findings, you need permissions to edit a policy in Azure Policy. Learn more in [Azure RBAC permissions in Azure Policy](/azure/governance/policy/overview#azure-rbac-permissions-in-azure-policy).
> - Disabled findings will still be included in the weekly SQL vulnerability assessment email report.
> - Disabled rules are shown in the "Not applicable" section of the scan results.

**To create a rule**:

1. From the recommendations detail page for **Vulnerability assessment findings on your SQL servers on machines should be remediated**, select **Disable rule**.
1. Select the relevant scope.
1. Define your criteria. You can use any of the following criteria:

    - Finding ID
    - Severity
    - Benchmarks

    :::image type="content" source="media/defender-for-sql-Azure-vulnerability-assessment/disable-rule-vulnerability-findings-sql.png" alt-text="Screenshot of create a disable rule for VA findings on SQL servers on machines.":::

1. Select **Apply rule**. Changes might take up to 24 hours to take effect.
1. To view, override, or delete a rule:
    1. Select **Disable rule**.
    1. From the scope list, subscriptions with active rules show as **Rule applied**.

        :::image type="content" source="media/defender-for-sql-Azure-vulnerability-assessment/modify-rule.png" alt-text="Screenshot of modify or delete an existing rule.":::

    1. To view or delete the rule, select the ellipsis menu ("...").

### Manage vulnerability assessments programmatically

#### Azure PowerShell

> [!NOTE]
> This article uses the Azure Az PowerShell module, which is the recommended PowerShell module for interacting with Azure. To get started with the Az PowerShell module, see [Install Azure PowerShell](/powershell/azure/install-azure-powershell). To learn how to migrate to the Az PowerShell module, see [Migrate Azure PowerShell from AzureRM to Az](/powershell/azure/migrate-from-azurerm-to-az).

> [!IMPORTANT]
> The PowerShell Azure Resource Manager module is still supported, but all future development is for the Az.Sql module. For these cmdlets, see [AzureRM.Sql](/powershell/module/AzureRM.Sql/). The arguments for the commands in the Az module and in the AzureRm modules are substantially identical.

You can use Azure PowerShell cmdlets to programmatically manage your vulnerability assessments. The supported cmdlets are:

| Cmdlet name as a link                                                                                                                                      | Description                                                                                                                                  |
| :--------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)                 | Clears the vulnerability assessment rule baseline.<br/>First, set the baseline before you use this cmdlet to clear it.                       |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting)                           | Clears the vulnerability assessment settings of a database.                                                                                  |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Clears the vulnerability assessment rule baseline of a managed database.<br/>First, set the baseline before you use this cmdlet to clear it. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting)           | Clears the vulnerability assessment settings of a managed database.                                                                          |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting)                           | Clears the vulnerability assessment settings of a managed instance.                                                                          |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan)                             | Converts vulnerability assessment scan results of a database to an Excel file (export).                                                      |
| [Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan)             | Converts vulnerability assessment scan results of a managed database to an Excel file (export).                                              |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)                     | Gets the vulnerability assessment rule baseline of a database for a given rule.                                                              |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline)     | Gets the vulnerability assessment rule baseline of a managed database for a given rule.                                                      |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord)                         | Gets all vulnerability assessment scan records associated with a given database.                                                             |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord)         | Gets all vulnerability assessment scan records associated with a given managed database.                                                     |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting)                               | Returns the vulnerability assessment settings of a database.                                                                                 |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting)               | Returns the vulnerability assessment settings of a managed database.                                                                         |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)                     | Sets the vulnerability assessment rule baseline.                                                                                             |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline)     | Sets the vulnerability assessment rule baseline for a managed database.                                                                      |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan)                                 | Triggers the start of a vulnerability assessment scan on a database.                                                                         |
| [Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan)                 | Triggers the start of a vulnerability assessment scan on a managed database.                                                                 |
| [Update-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting)                         | Updates the vulnerability assessment settings of a database.                                                                                 |
| [Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting)         | Updates the vulnerability assessment settings of a managed database.                                                                         |
| [Update-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting)                         | Updates the vulnerability assessment settings of a managed instance.                                                                         |

For a script example, see [Azure SQL vulnerability assessment PowerShell support](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support).

#### Azure CLI

> [!IMPORTANT]
> The following Azure CLI commands are for SQL databases hosted on VMs or on-premises machines. For vulnerability assessments regarding Azure SQL Databases, refer to the Azure portal or PowerShell section.

You can use Azure CLI commands to programmatically manage your vulnerability assessments. The supported commands are:

| Command name as a link                                                                                       | Description                                                                            |
| :----------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------- |
| [`az security va sql baseline delete`](/cli/azure/security/va/sql/baseline#az-security-va-sql-baseline-delete) | Delete SQL vulnerability assessment rule baseline.                                     |
| [`az security va sql baseline list`](/cli/azure/security/va/sql/baseline#az-security-va-sql-baseline-list)     | View SQL vulnerability assessment baseline for all rules.                              |
| [`az security va sql baseline set`](/cli/azure/security/va/sql/baseline#az-security-va-sql-baseline-set)       | Sets SQL vulnerability assessment baseline. Replaces the current baseline.             |
| [`az security va sql baseline show`](/cli/azure/security/va/sql/baseline#az-security-va-sql-baseline-show)     | View SQL vulnerability assessment rule baseline.                                       |
| [`az security va sql baseline update`](/cli/azure/security/va/sql/baseline#az-security-va-sql-baseline-update) | Update SQL vulnerability assessment rule baseline. Replaces the current rule baseline. |
| [`az security va sql results list`](/cli/azure/security/va/sql/results#az-security-va-sql-results-list)        | View all SQL vulnerability assessment scan results.                                    |
| [`az security va sql results show`](/cli/azure/security/va/sql/results#az-security-va-sql-results-show)        | View SQL vulnerability assessment scan results.                                        |
| [`az security va sql scans list`](/cli/azure/security/va/sql/scans#az-security-va-sql-scans-list)              | List all SQL vulnerability assessment scan summaries.                                  |
| [`az security va sql scans show`](/cli/azure/security/va/sql/scans#az-security-va-sql-scans-show)              | View SQL vulnerability assessment scan summaries.                                      |

#### Resource Manager templates

To configure vulnerability assessment baselines by using Azure Resource Manager templates, use the `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` type.

Ensure that you have enabled `vulnerabilityAssessments` before you add baselines.

Here's an example for defining Baseline Rule VA2065 to `master` database and VA1143 to `user` database as resources in a Resource Manager template:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAapiVersion": "2018-06-01",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAapiVersion": "2018-06-01",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

For `master` database and `user` database, the resource names are defined differently:

- Master database - "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2065/<b>master</b>')]",
- User database - "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2065/<b>default</b>')]",

To handle Boolean types as true/false, set the baseline result with binary input like "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityapiVersion": "2018-06-01",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## Related content

- Learn more about [Microsoft Defender for Azure SQL](defender-for-sql-introduction.md).
- Learn more about [data discovery and classification](/azure/azure-sql/database/data-discovery-and-classification-overview).
- Learn more about [storing vulnerability assessment scan results in a storage account accessible behind firewalls and VNets](/azure/azure-sql/database/sql-database-vulnerability-assessment-storage).
- Check out [common questions](faq-defender-for-databases.yml) about Azure SQL databases.
