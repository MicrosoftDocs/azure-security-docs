---
title: Verify Defender for Containers deployment on Arc-enabled Kubernetes
description: Learn how to verify that Microsoft Defender for Containers is properly deployed on your Arc-enabled Kubernetes clusters.
ms.topic: how-to
ms.date: 06/04/2025
---

# Verify Defender for Containers deployment on Arc-enabled Kubernetes

After enabling Defender for Containers, verify that all components are properly deployed and functioning on your Arc-enabled clusters.

## Verify Arc connection

### Check Arc agent status

```bash
# Check Arc agent pods
kubectl get pods -n azure-arc

# Verify Arc operators
kubectl get deployments -n azure-arc

# Check connectivity status
kubectl logs -n azure-arc -l app.kubernetes.io/component=connect-agent --tail=50
```

### Using Azure CLI

```azurecli
# Verify cluster connection
az connectedk8s show \
    --name <cluster-name> \
    --resource-group <resource-group> \
    --query connectivityStatus
```

## Verify Defender extension

### Check extension status

```azurecli
# Get extension details
az k8s-extension show \
    --name microsoft.azuredefender.kubernetes \
    --cluster-type connectedClusters \
    --cluster-name <cluster-name> \
    --resource-group <resource-group>

# Check provisioning state
az k8s-extension show \
    --name microsoft.azuredefender.kubernetes \
    --cluster-type connectedClusters \
    --cluster-name <cluster-name> \
    --resource-group <resource-group> \
    --query provisioningState
```

### Verify extension components

```bash
# List Defender pods
kubectl get pods -n kube-system -l app=microsoft-defender

# Check DaemonSet
kubectl get daemonset -n kube-system microsoft-defender-sensor

# Expected output:
# NAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE
# microsoft-defender-sensor   5         5         5       5            5
```

## Verify sensor deployment

### Check sensor health

```bash
# View sensor logs
kubectl logs -n kube-system -l app=microsoft-defender --tail=100

# Check for errors
kubectl logs -n kube-system -l app=microsoft-defender | grep -i error

# Describe pods for issues
kubectl describe pods -n kube-system -l app=microsoft-defender
```

### Verify resource consumption

```bash
# Check CPU and memory usage
kubectl top pods -n kube-system -l app=microsoft-defender

# View resource requests and limits
kubectl describe daemonset -n kube-system microsoft-defender-sensor | grep -A 5 Resources
```

## Verify data collection

### Check Log Analytics connection

```bash
# Verify OMS agent (if deployed)
kubectl get daemonset -n kube-system omsagent

# Check logs are being sent
kubectl logs -n kube-system -l component=oms-agent --tail=50
```

### Query data in Log Analytics

Run these queries in your Log Analytics workspace:

```kusto
// Check if data is flowing
KubeEvents
| where TimeGenerated > ago(1h)
| summarize count() by Computer, _ResourceId
| take 10

// Verify security events
SecurityEvent
| where TimeGenerated > ago(1h)
| where Computer contains "arc"
| summarize count() by Activity
```

## Verify Azure Policy extension

If Azure Policy for Kubernetes is deployed:

```bash
# Check Azure Policy pods
kubectl get pods -n kube-system -l app=azure-policy

# Verify Gatekeeper deployment
kubectl get pods -n gatekeeper-system

# List constraint templates
kubectl get constrainttemplates
```

### Check policy compliance

```azurecli
# Get policy compliance state
az policy state list \
    --resource "/subscriptions/<sub-id>/resourceGroups/<rg>/providers/Microsoft.Kubernetes/connectedClusters/<cluster-name>" \
    --query "[?complianceState=='NonCompliant'].{Policy:policyDefinitionName, State:complianceState}"
```

## Test security detection

### Generate a test alert

```bash
# Run a benign test that triggers an alert
kubectl run test-pod \
    --image=busybox \
    --rm -it \
    --restart=Never \
    -- /bin/sh -c "echo 'Testing Arc Defender' > /etc/hosts"
```

### Verify alert generation

1. Wait 5-10 minutes for processing.
2. Check alerts in the Microsoft Defender for Cloud portal under **Alerts**. Look for alerts generated by the test pod activity.