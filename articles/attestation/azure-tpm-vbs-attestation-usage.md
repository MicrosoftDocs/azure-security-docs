---
title: Azure TPM VBS attestation usage 
description: Learn about how to apply TPM and VBS attestation
services: attestation
author: prsriva
ms.service: azure-attestation
ms.topic: overview
ms.date: 09/05/2022
ms.author: prsriva
ms.custom: tpm attestation
---

# Using Trusted Platform Module (TPM)/Virtualization-Based Security (VBS) attestation

Attestation can be integrated into various applications and services, catering to different use cases. Azure Attestation service, which acts the remote attestation service can be used for desired purposes by updating the attestation policy. The policy engine works as processor, which takes the incoming payload as evidence and performs the validations as authored in the policy. This architecture simplifies the workflow and enables the service owner to purpose build solutions for the varied platforms and use cases.The workflow remains the same as described in [Azure attestation workflow](workflow.md). The attestation policy needs to be crafted as per the validations required.

Attesting a platform has its own challenges. With the varied components of boot and setup, you must rely on a hardware root-of-trust anchor that can be used to verify the first steps of the boot and extend that trust upwards into every layer on your system. A hardware TPM provides such an anchor for a remote attestation solution. Azure Attestation provides a highly scalable measured boot and runtime integrity measurement attestation solution with a revocation framework to give you full control over platform attestation.

## Attestation steps

Attestation Setup has two setups. One pertaining to the service setup and one pertaining to the client setup.

:::image type="content" source="./media/tpm-attestation-setup.png" alt-text="A diagram that shows the different interactions for attestation." lightbox="./media/tpm-attestation-setup.png":::

For more information, see [Azure attestation workflow](workflow.md).

### Service endpoint setup

Service endpoint setup is the first step for any attestation to be performed. Setting up an endpoint can be performed either via code or using the Azure portal.

Here's how you can set up an attestation endpoint using Portal

1. Prerequisite: Access to the Microsoft Entra tenant and subscription under which you want to create the attestation endpoint. For more information, see [Microsoft Entra tenant](/azure/active-directory/develop/quickstart-create-new-tenant).
1. Create an endpoint under the desired resource group, with the desired name.
    > [!VIDEO https://learn-video.azurefd.net/vod/player?id=8d3c6aa5-7712-4b47-b3ea-23c49539cd31]
1. Add Attestation Contributor Role to the Identity who will be responsible to update the attestation policy.
    > [!VIDEO https://learn-video.azurefd.net/vod/player?id=342d7a36-788a-4d42-ae97-00295e2fe6a1]

1. Configure the endpoint with the required policy.
> [!VIDEO https://learn-video.azurefd.net/vod/player?id=33995690-31e5-4121-9cd5-e61674d3c94d]

Sample policies can be found in the [policy section](tpm-attestation-sample-policies.md).

> [!NOTE]
> TPM endpoints are designed to be provisioned without a default attestation policy.

### Client setup

A client to communicate with the attestation service endpoint needs to ensure it's following the protocol as described in the [protocol documentation](virtualization-based-security-protocol.md). Use the [Attestation Client NuGet](https://www.nuget.org/packages/Microsoft.Attestation.Client) to ease the integration.

1. Prerequisite: a Microsoft Entra identity is needed to access the TPM endpoint. For more information, see [Microsoft Entra identity tokens](/azure/active-directory/develop/v2-overview).
2. Add Attestation Reader Role to the identity that will be need for authentication against the endpoint.
  > [!VIDEO https://learn-video.azurefd.net/vod/player?id=1c70f4b2-e3e7-4b64-9fb1-ceb2810c669c]

## Execute the attestation workflow

Using the [Client](https://github.com/microsoft/Attestation-Client-Samples) to trigger an attestation flow. A successful attestation will result in an attestation report (encoded JWT token). Parsing the JWT token, the contents of the report can be easily validated against expected outcome.

> [!VIDEO https://learn-video.azurefd.net/vod/player?id=a10576ad-08fe-4663-9ff5-17081de141d0]

Here's a sample of the contents of the attestation report.
:::image type="content" source="./media/sample-decoded-token.jpg" alt-text="Sample snapshot of a decoded token for tpm attestation." lightbox="./media/sample-decoded-token.jpg":::

Using the Open ID [metadata endpoint](/rest/api/attestation/metadata-configuration/get?tabs=HTTP) contains properties, which describe the attestation service.The signing keys describe the keys, which will be used to sign tokens generated by the attestation service. All tokens emitted by the attestation service will be signed by one of the certificates listed in the attestation signing keys.

## Next steps
- [Set up Azure Attestation using PowerShell](quickstart-powershell.md)
- [Attest an SGX enclave using code samples](/samples/browse/?expanded=azure&terms=attestation)
- [Learn more about policy](policy-reference.md)
